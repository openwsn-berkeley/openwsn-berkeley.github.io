<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>OpenWSN Firmware: C:/Jenkins/jobs/Firmware Docs/workspace/firmware/openos/bsp/boards/xpressohack/spi.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenWSN Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('xpressohack_2spi_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">spi.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="spi_8h_source.html">spi.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="board_8h_source.html">board.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="clkpwr_8h_source.html">clkpwr.h</a>&quot;</code><br/>
<code>#include &quot;LPC17xx.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="ssp__spi__wrapper_8h_source.html">ssp_spi_wrapper.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structspi__vars__t.html">spi_vars_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">eZ430-RF2500-specific definition of the "spi" bsp module.  <a href="structspi__vars__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a2fea60141e8669444151bdd5f0a018e8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#a2fea60141e8669444151bdd5f0a018e8">SSP_ENABLED</a></td></tr>
<tr class="memdesc:a2fea60141e8669444151bdd5f0a018e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">LPC17XX-specific definition of the "spi" bsp module.  <a href="#a2fea60141e8669444151bdd5f0a018e8">More...</a><br/></td></tr>
<tr class="separator:a2fea60141e8669444151bdd5f0a018e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc2859b88c022ccb5916f671f08f43ca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#adc2859b88c022ccb5916f671f08f43ca">PIN_MASK_CS</a>&#160;&#160;&#160;(1&lt;&lt;6)</td></tr>
<tr class="separator:adc2859b88c022ccb5916f671f08f43ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad3cd491353e7c161fe9aba57a15e476"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#aad3cd491353e7c161fe9aba57a15e476">SPI_IE</a>&#160;&#160;&#160;(1&lt;&lt;7)</td></tr>
<tr class="separator:aad3cd491353e7c161fe9aba57a15e476"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a49a9323b5e0f95d8f08cccde5439e6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#a5a49a9323b5e0f95d8f08cccde5439e6">SPI_LSB</a>&#160;&#160;&#160;(1&lt;&lt;6)</td></tr>
<tr class="separator:a5a49a9323b5e0f95d8f08cccde5439e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1bf94e0fd155ce0082cc29e9aaa69ea"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#aa1bf94e0fd155ce0082cc29e9aaa69ea">SPI_MST</a>&#160;&#160;&#160;(1&lt;&lt;5)</td></tr>
<tr class="separator:aa1bf94e0fd155ce0082cc29e9aaa69ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab63d9c1408fd05dfc56c5d3a36c7e1ab"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#ab63d9c1408fd05dfc56c5d3a36c7e1ab">SPI_SPIF</a>&#160;&#160;&#160;(1&lt;&lt;7)</td></tr>
<tr class="separator:ab63d9c1408fd05dfc56c5d3a36c7e1ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8e335b1f808bd7408d2aef2377adcb1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#ad8e335b1f808bd7408d2aef2377adcb1">SPI_CPOL</a>&#160;&#160;&#160;(1&lt;&lt;4)</td></tr>
<tr class="separator:ad8e335b1f808bd7408d2aef2377adcb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49e8927a636f45641d6231ac63b9e598"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#a49e8927a636f45641d6231ac63b9e598">SPI_CPHA</a>&#160;&#160;&#160;(1&lt;&lt;3)</td></tr>
<tr class="separator:a49e8927a636f45641d6231ac63b9e598"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4549d5dc21db5356eb73470e66459f78"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#a4549d5dc21db5356eb73470e66459f78">SPI_IRQHandler</a> (void)</td></tr>
<tr class="separator:a4549d5dc21db5356eb73470e66459f78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5db0aceecaf7db5fbe2984e88fef3734"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#a5db0aceecaf7db5fbe2984e88fef3734">spi_init</a> ()</td></tr>
<tr class="separator:a5db0aceecaf7db5fbe2984e88fef3734"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2fb3e956c783d2d4d5e7e418aa6fff0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#ac2fb3e956c783d2d4d5e7e418aa6fff0">spi_txrx</a> (<a class="el" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *bufTx, <a class="el" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> lenbufTx, <a class="el" href="spi_8h.html#acc3b28d69cd1e029d05f77aa7d1ede06">spi_return_t</a> returnType, <a class="el" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *bufRx, <a class="el" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> maxLenBufRx, <a class="el" href="spi_8h.html#af5f18ca9b261f81e8649655fa1bdb3a2">spi_first_t</a> isFirst, <a class="el" href="spi_8h.html#a6a8a77d768dca340b71324f2aec66a97">spi_last_t</a> isLast)</td></tr>
<tr class="separator:ac2fb3e956c783d2d4d5e7e418aa6fff0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a8b57112149902842e4be27339bba4ce1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structspi__vars__t.html">spi_vars_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xpressohack_2spi_8c.html#a8b57112149902842e4be27339bba4ce1">spi_vars</a></td></tr>
<tr class="separator:a8b57112149902842e4be27339bba4ce1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="adc2859b88c022ccb5916f671f08f43ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_MASK_CS&#160;&#160;&#160;(1&lt;&lt;6)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a49e8927a636f45641d6231ac63b9e598"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPI_CPHA&#160;&#160;&#160;(1&lt;&lt;3)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ad8e335b1f808bd7408d2aef2377adcb1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPI_CPOL&#160;&#160;&#160;(1&lt;&lt;4)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aad3cd491353e7c161fe9aba57a15e476"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPI_IE&#160;&#160;&#160;(1&lt;&lt;7)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a5a49a9323b5e0f95d8f08cccde5439e6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPI_LSB&#160;&#160;&#160;(1&lt;&lt;6)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aa1bf94e0fd155ce0082cc29e9aaa69ea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPI_MST&#160;&#160;&#160;(1&lt;&lt;5)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab63d9c1408fd05dfc56c5d3a36c7e1ab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPI_SPIF&#160;&#160;&#160;(1&lt;&lt;7)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a2fea60141e8669444151bdd5f0a018e8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SSP_ENABLED</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>LPC17XX-specific definition of the "spi" bsp module. </p>
<dl class="section author"><dt>Author</dt><dd>Xavi Vilajosana <a href="#" onclick="location.href='mai'+'lto:'+'xvi'+'la'+'jos'+'an'+'a@e'+'ec'+'s.b'+'er'+'kel'+'ey'+'.ed'+'u'; return false;">xvila<span style="display: none;">.nosp@m.</span>josa<span style="display: none;">.nosp@m.</span>na@ee<span style="display: none;">.nosp@m.</span>cs.b<span style="display: none;">.nosp@m.</span>erkel<span style="display: none;">.nosp@m.</span>ey.e<span style="display: none;">.nosp@m.</span>du</a>, February 2012.</dd></dl>
<p>The SPI is configured using the following registers: (page 401 of the manual)</p>
<h1>Power: In the PCONP register (Table 46), set bit PCSPI.</h1>
<dl class="section note"><dt>Note</dt><dd>On reset, the SPI is enabled (PCSPI = 1). <h1>Clock: In the PCLKSEL0 register (Table 40), set bit PCLK_SPI. In master mode,</h1>
</dd></dl>
<p>the clock must be an even number greater than or equal to 8 (see Section 17.7.4). </p>
<h1>Pins: The SPI pins are configured using both PINSEL0 (Table 79) and PINSEL1</h1>
<p>(Table 80), as well as the PINMODE (Section 8.4) register. PINSEL0[31:30] is used to configure the SPI CLK pin. PINSEL1[1:0], PINSEL1[3:2] and PINSEL1[5:4] are used to configure the pins SSEL, MISO and MOSI, respectively. </p>
<h1>Interrupts: The SPI interrupt flag is enabled using the S0SPINT[0] bit (Section 17.7.7).</h1>
<p>The SPI interrupt flag must be enabled in the NVIC, see Table 50.</p>
<p>RADIO SPI</p>
<p>The SPI is based on a byte-oriented protocol and is always a bidirectional communication between master and slave. The SPI master starts the transfer by asserting /SEL = L. Then the master generates eight SPI clock cycles to transfer one byte to the radio transceiver (via MOSI). At the same time, the slave transmits one byte to the master (via MISO). When the master wants to receive one byte of data from the slave it must also transmit one byte to the slave. All bytes are transferred with MSB first. An SPI transaction is finished by releasing /SEL = H. An SPI register access consists of two bytes, a Frame Buffer or SRAM access of at least two or more bytes as described in Section 6.2 “SPI Protocol” on page 19. /SEL = L enables the MISO output driver of the AT86RF231. The MSB of MISO is valid after t1 (see Section 12.4 “Digital Interface Timing Characteristics” on page 157 parameter 12.4.3) and is updated at each falling edge of SCLK. If the driver is disabled, there is no internal pull-up cir- cuitry connected to it. Driving the appropriate signal level must be ensured by the master device or an external pull-up resistor. Note, when both /SEL and /RST are active, the MISO output driver is also enabled. Referring to Figure 6-2 on page 17 and Figure 6-3 on page 17 MOSI is sampled at the rising edge of the SCLK signal and the output is set at the falling edge of SCLK. The signal must be stable before and after the rising edge of SCLK as specified by t3 and t4, refer to Section 12.4 “Digital Interface Timing Characteristics” on page 157 parameters 12.4.5 and 12.4.6. This SPI operational mode is commonly known as "SPI mode 0". </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a5db0aceecaf7db5fbe2984e88fef3734"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spi_init </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a4549d5dc21db5356eb73470e66459f78"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SPI_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ac2fb3e956c783d2d4d5e7e418aa6fff0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spi_txrx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *&#160;</td>
          <td class="paramname"><em>bufTx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>lenbufTx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="spi_8h.html#acc3b28d69cd1e029d05f77aa7d1ede06">spi_return_t</a>&#160;</td>
          <td class="paramname"><em>returnType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *&#160;</td>
          <td class="paramname"><em>bufRx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>maxLenBufRx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="spi_8h.html#af5f18ca9b261f81e8649655fa1bdb3a2">spi_first_t</a>&#160;</td>
          <td class="paramname"><em>isFirst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="spi_8h.html#a6a8a77d768dca340b71324f2aec66a97">spi_last_t</a>&#160;</td>
          <td class="paramname"><em>isLast</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a8b57112149902842e4be27339bba4ce1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structspi__vars__t.html">spi_vars_t</a> spi_vars</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_4916502eeeee2174d69d9d347bc18007.html">firmware</a></li><li class="navelem"><a class="el" href="dir_f8f7d70f6415baf543d11d3df711609b.html">openos</a></li><li class="navelem"><a class="el" href="dir_fba537fa10109a2d53db2e436cca2a6d.html">bsp</a></li><li class="navelem"><a class="el" href="dir_864a9ed3651b201e1aa10451e7ef593c.html">boards</a></li><li class="navelem"><a class="el" href="dir_dfb2b58d5d8fe4fd3a0267570f3a21df.html">xpressohack</a></li><li class="navelem"><a class="el" href="xpressohack_2spi_8c.html">spi.c</a></li>
    <li class="footer">Generated on Wed Sep 11 2013 04:38:47 for OpenWSN Firmware by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
